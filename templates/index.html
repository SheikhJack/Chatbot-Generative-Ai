<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chatbot</title>

    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome (optional) -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      rel="stylesheet"
    />
    <!-- Your custom CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <section>
      <div class="container py-5">
        <div class="row justify-content-center">
          <div class="col-md-8 col-lg-6 col-xl-4">
            <div class="card" id="chat1">
              <!-- Header -->
              <div
                class="card-header text-white bg-info d-flex justify-content-between align-items-center"
              >
                <i class="fas fa-angle-left"></i>
                <p class="mb-0 fw-bold">Live Chat</p>
                <i class="fas fa-times"></i>
              </div>

              <!-- Chat Body -->
              <div class="card-body">
                <!-- Bot Message -->
                <div class="d-flex justify-content-center mb-3">
                  <img
                    src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava1-bg.webp"
                    alt="Bot"
                    class="me-2"
                  />
                  <div class="p-3 bg-light rounded">
                    <p class="mb-0 small">
                      Hello and thank you for visiting! Please type your message
                      below.
                    </p>
                  </div>
                </div>

                <!-- Placeholder for dynamic content -->
                <!-- Messages will be appended here by jQuery -->

                <!-- Input Area -->
                <div class="form-outline mt-100">
                  <div id="chat-messages">
                    <!-- All chat messages will go here -->
                  </div>
                  <textarea
                    class="form-control"
                    id="textAreaExample"
                    rows="3"
                    placeholder="Type your message..."
                  ></textarea>
                  <button id="sendBtn" class="btn btn-info mt-2">Send</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Optional Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      $(document).ready(function () {
        $("#sendBtn").click(function () {
          var msg = $("#textAreaExample").val().trim();

          if (msg !== "") {
            // Append user's message
            $("#chat-messages").append(`
            <div class="d-flex justify-content-end mb-3">
              <div class="p-3 bg-secondary text-white rounded" style="max-width: 75%;">
                <p class="mb-0 small">${msg}</p>
              </div>
            </div>
          `);
            $("#textAreaExample").val("");

            // AJAX to Flask
            $.ajax({
              type: "POST",
              url: "/ask",
              data: { msg: msg },
              success: function (response) {
                $("#chat-messages").append(`
                <div class="d-flex align-items-start mb-3">
                  <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava1-bg.webp"
                       alt="Bot" class="me-2" />
                  <div class="p-3 bg-light rounded" style="max-width: 75%;">
                    <p class="mb-0 small">${response}</p>
                  </div>
                </div>
              `);
                // Auto-scroll to bottom
                $(".card-body").scrollTop($(".card-body")[0].scrollHeight);
              },
              error: function () {
                alert("Error contacting the server!");
              },
            });
          }
        });
      });
    </script>
  </body>
</html>
